<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Reading Quest Master</title>
    <style>
      :root {
        --sky: #a1c4fd;
        --grass: #81c784;
        --gold: #fbc02d;
        --silver: #b0bec5;
        --bronze: #a1887f;
        --dark: #4e342e;
      }

      * {
        box-sizing: border-box;
        font-family: "Kanit", sans-serif;
      }

      body {
        margin: 0;
        background: linear-gradient(180deg, var(--sky) 0%, #c2e9fb 100%);
        color: var(--dark);
        display: flex;
        justify-content: center;
        min-height: 100vh;
      }

      .app-container {
        width: 100%;
        max-width: 450px;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        padding: 15px;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      /* Header & DateTime */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 5px 10px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      #datetime {
        font-size: 0.85rem;
        font-weight: bold;
        color: #555;
      }

      /* Stats Card */
      .stats-card {
        background: white;
        border-radius: 20px;
        padding: 15px;
        text-align: center;
        border: 3px solid var(--gold);
        margin-bottom: 15px;
      }

      .total-score {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--gold);
        line-height: 1;
      }
      .rank-text {
        font-size: 1rem;
        margin-top: 5px;
        color: #795548;
        font-weight: bold;
      }

      /* Ladder Area */
      .game-area {
        flex-grow: 1;
        overflow-y: auto;
        padding: 10px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 15px;
        margin-bottom: 15px;
        border: 2px solid rgba(255, 255, 255, 0.8);
      }

      .ladder {
        display: flex;
        flex-direction: column-reverse;
        gap: 6px;
      }

      .step {
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        padding: 0 15px;
        font-size: 0.9rem;
        position: relative;
        background: white;
        border: 2px solid #ddd;
        transition: 0.3s;
      }

      /* Milestone Styling */
      .step.daily-bonus {
        border-color: #ffb74d;
        background: #fff3e0;
      }
      .step.weekly-bonus {
        border-color: #4fc3f7;
        background: #e1f5fe;
        border-width: 3px;
      }

      .step.done {
        background: #c8e6c9;
        border-color: #81c784;
        opacity: 0.7;
      }
      .step.active {
        background: #fff176;
        border-color: #fbc02d;
        transform: scale(1.03);
        z-index: 2;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .step-label {
        font-weight: 500;
      }
      .step-reward {
        margin-left: auto;
        font-size: 0.75rem;
        color: #e64a19;
      }

      .player {
        position: absolute;
        right: -5px;
        font-size: 1.5rem;
        filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
      }

      /* Task Menu */
      .task-menu {
        background: white;
        border-radius: 20px;
        padding: 15px;
        box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.05);
      }

      .task-btn {
        width: 100%;
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 15px;
        border: none;
        background: #f1f8e9;
        color: #33691e;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: 0.2s;
      }

      .task-btn:active {
        transform: scale(0.98);
      }
      .task-btn span:last-child {
        background: var(--grass);
        color: white;
        padding: 2px 10px;
        border-radius: 10px;
      }

      .reset-link {
        text-align: center;
        font-size: 0.8rem;
        color: #999;
        margin-top: 10px;
        text-decoration: underline;
        cursor: pointer;
        transition: 0.2s;
      }

      .reset-link:hover {
        color: #000;
        font-weight: bold;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-container">
      <div class="header">
        <span>üìñ <span id="subjectHeader"></span></span>
        <span id="datetime">--/--/-- --:--</span>
      </div>

      <div class="stats-card">
        <div class="total-score" id="totalScore">0</div>
        <div class="rank-text" id="rankText">Rank: Beginner</div>
      </div>

      <div class="game-area">
        <div class="ladder" id="ladder"></div>
      </div>

      <div class="task-menu">
        <button class="task-btn" onclick="addScore(1)">
          <span>üìñ ‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠/‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô (30‡∏ô‡∏≤‡∏ó‡∏µ)</span> <span>+1</span>
        </button>
        <button class="task-btn" onclick="addScore(2)">
          <span>üî• ‡∏ß‡∏¥‡∏ä‡∏≤‡∏¢‡∏≤‡∏Å/‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏ç‡πà (45‡∏ô‡∏≤‡∏ó‡∏µ)</span> <span>+2</span>
        </button>
        <button
          class="task-btn"
          style="background: #e3f2fd; color: #0d47a1"
          onclick="addScore(1)"
        >
          <span>üìù ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏±‡πâ‡∏ô‡πÜ</span> <span>+1</span>
        </button>

        <div class="reset-link" onclick="resetGame()">
          ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÉ‡∏´‡∏°‡πà / ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°
        </div>
      </div>

      <div
        class="reset-link"
        onclick="goBackToSelect()"
        style="margin-top: 5px"
      >
        <!-- ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ / ‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà -->
        üîô‚Æú‚Æò‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ / ‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà
      </div>
    </div>

    <script>

    // ===== ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ - ‡∏ß‡∏¥‡∏ä‡∏≤ =====
    const branch = localStorage.getItem('selected_branch');
    const subject = localStorage.getItem('selected_subject');

    if(branch && subject){
        document.getElementById('subjectHeader').innerText =
            branch + " - " + subject;
    }

    function goBackToSelect(){
        window.location.href = "index.html";
    }

    let score = parseInt(localStorage.getItem('study_score')) || 0;
      const maxScore = 18;

      // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
      function updateTime() {
        const now = new Date();
        const options = {
          weekday: "short",
          day: "2-digit",
          month: "short",
          hour: "2-digit",
          minute: "2-digit",
        };
        document.getElementById("datetime").innerText = now.toLocaleDateString(
          "th-TH",
          options,
        );
      }
      setInterval(updateTime, 1000);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î
      function buildLadder() {
        const ladder = document.getElementById("ladder");
        ladder.innerHTML = "";

        for (let i = 1; i <= maxScore; i++) {
          const step = document.createElement("div");
          step.className = "step";
          step.id = `step-${i}`;

          let rewardMsg = "";

          // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å 3 ‡∏Ç‡∏±‡πâ‡∏ô (‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)
          if (i % 3 === 0 && i % 6 !== 0) {
            step.classList.add("daily-bonus");
            rewardMsg = "üéÅ ‡∏û‡∏±‡∏Å‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 15 ‡∏ô‡∏≤‡∏ó‡∏µ";
          }

          // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å 6 ‡∏Ç‡∏±‡πâ‡∏ô (‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå / Rank)
          if (i === 6) {
            step.classList.add("weekly-bonus");
            rewardMsg = "ü•â BRONZE: ‡∏Ç‡∏ô‡∏°/‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°";
          } else if (i === 12) {
            step.classList.add("weekly-bonus");
            rewardMsg = "ü•à SILVER: ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á 1 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á";
          } else if (i === 18) {
            step.classList.add("weekly-bonus");
            rewardMsg = "üèÜ GOLD: ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå!";
          }

          step.innerHTML = `
                <span class="step-label">‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${i}</span>
                <span class="step-reward">${rewardMsg}</span>
            `;
          ladder.appendChild(step);
        }
        render();
      }

      function addScore(points) {
        score += points;
        if (score > maxScore) score = maxScore;
        localStorage.setItem("study_score", score);
        render();
        checkAlerts(points);
      }

      function render() {
        document.getElementById("totalScore").innerText = score;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Rank
        const rankTxt = document.getElementById("rankText");
        if (score >= 18)
          rankTxt.innerHTML =
            "Rank: <span style='color:#fbc02d'>GOLD MASTER üëë</span>";
        else if (score >= 12)
          rankTxt.innerHTML =
            "Rank: <span style='color:#90a4ae'>SILVER ELITE</span>";
        else if (score >= 6)
          rankTxt.innerHTML =
            "Rank: <span style='color:#a1887f'>BRONZE CHALLENGER</span>";
        else rankTxt.innerText = "Rank: Beginner";

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î
        for (let i = 1; i <= maxScore; i++) {
          const el = document.getElementById(`step-${i}`);
          el.classList.remove("active", "done");
          const p = el.querySelector(".player");
          if (p) p.remove();

          if (i < score) {
            el.classList.add("done");
          } else if (i === score && score > 0) {
            el.classList.add("active");
            el.innerHTML += `<span class="player">üèÉ</span>`;
            el.scrollIntoView({ behavior: "smooth", block: "center" });
          }
        }
      }

      function checkAlerts(added) {
        if (score % 3 === 0 && score % 6 !== 0) {
          alert("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô: ‡∏û‡∏±‡∏Å‡πÄ‡∏•‡πà‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 15 ‡∏ô‡∏≤‡∏ó‡∏µ üéâ");
        } else if (score === 6 || score === 12 || score === 18) {
          alert(
            "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö Rank ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏ç‡πà üéÅ",
          );
        }
      }

      function resetGame() {
        if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) {
          score = 0;
          localStorage.setItem("study_score", 0);
          render();
        }
      }

function goBackToSelect(){

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    score = 0;
    localStorage.setItem('study_score', 0);

    // (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô)
    // localStorage.removeItem('study_score');

    window.location.href = "index.html";
}

      updateTime();
      buildLadder();
    </script>
  </body>
</html>
