<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Reading Ladder Game</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
*{box-sizing:border-box}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
background:linear-gradient(160deg,#6dd5ed,#2193b0);
color:white;
display:flex;
justify-content:center;
min-height:100vh;
padding:env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
}

.app{
width:100%;
max-width:480px;
}

.card{
background:white;
color:#333;
border-radius:20px;
padding:20px;
box-shadow:0 10px 25px rgba(0,0,0,.2);
margin-top:20px;
}

h2{margin-top:0}

input{
width:100%;
padding:12px;
margin:8px 0;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
}

button{
width:100%;
padding:14px;
border:none;
border-radius:15px;
font-size:16px;
font-weight:bold;
margin:6px 0;
background:#ff9800;
color:white;
transition:.2s;
}

button:active{
transform:scale(.95);
background:#e68900;
}

.stats{
text-align:center;
font-size:15px;
margin-bottom:10px;
}

.board{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:6px;
margin-top:10px;
}

.cell{
aspect-ratio:1;
background:#e3f2fd;
border-radius:12px;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
position:relative;
font-size:14px;
}

.player{
width:18px;
height:18px;
background:red;
border-radius:50%;
position:absolute;
bottom:5px;
animation:pop .3s ease;
}

@keyframes pop{
0%{transform:scale(.3)}
100%{transform:scale(1)}
}

.rank{
text-align:center;
font-weight:bold;
margin-top:5px;
}

.logout{
background:#f44336;
}
</style>
</head>
<body>

<div class="app">

<div id="loginBox" class="card">
<h2>üìö Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<input type="text" id="studentId" placeholder="Student ID">
<button onclick="login()">Login / Register</button>
</div>

<div id="gameBox" class="card" style="display:none;">
<h2>üéÆ Reading Ladder</h2>

<div class="stats">
‚≠ê ‡πÅ‡∏ï‡πâ‡∏°: <span id="points">0</span><br>
üèÜ Level: <span id="level">1</span><br>
üë§ <span id="userEmail"></span>
</div>

<div class="board" id="board"></div>

<div class="rank">
Weekly Rank: <span id="weeklyRank">None</span>
</div>

<button onclick="addPoints(1)">‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô 30 ‡∏ô‡∏≤‡∏ó‡∏µ (+1)</button>
<button onclick="addPoints(1)">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î (+1)</button>
<button onclick="addPoints(2)">‡∏≠‡πà‡∏≤‡∏ô 45 ‡∏ô‡∏≤‡∏ó‡∏µ (+2)</button>
<button onclick="addPoints(3)">‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (+3)</button>

<button class="logout" onclick="logout()">Logout</button>
</div>

</div>

<script>
// ===== Firebase Config =====
const firebaseConfig={
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
databaseURL:"YOUR_DB_URL",
projectId:"YOUR_ID"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

// ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î 25 ‡∏ä‡πà‡∏≠‡∏á =====
const board=document.getElementById("board");
for(let i=1;i<=25;i++){
let cell=document.createElement("div");
cell.className="cell";
cell.id="cell"+i;
cell.innerText=i;
board.appendChild(cell);
}

function movePlayer(level){
document.querySelectorAll(".player").forEach(p=>p.remove());
let pos=level>25?25:level;
let player=document.createElement("div");
player.className="player";
document.getElementById("cell"+pos).appendChild(player);
}

// ===== Login =====
function login(){
const email=document.getElementById("email").value;
const password=document.getElementById("password").value;
const studentId=document.getElementById("studentId").value;

auth.signInWithEmailAndPassword(email,password)
.catch(()=>{
auth.createUserWithEmailAndPassword(email,password)
.then(user=>{
db.ref("users/"+user.user.uid).set({
email:email,
studentId:studentId,
points:0,
weeklyPoints:0
});
});
});
}

auth.onAuthStateChanged(user=>{
if(user){
loginBox.style.display="none";
gameBox.style.display="block";
userEmail.innerText=user.email;
loadData(user.uid);
}
});

// ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• =====
function loadData(uid){
db.ref("users/"+uid).on("value",snap=>{
let data=snap.val();
if(data){
points.innerText=data.points;
let level=Math.floor(data.points/5)+1;
levelSpan=level;
document.getElementById("level").innerText=level;
movePlayer(level);
updateWeekly(data.weeklyPoints);
}
});
}

// ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏° =====
function addPoints(p){
let user=auth.currentUser;
if(!user) return;

let ref=db.ref("users/"+user.uid);
ref.once("value").then(snap=>{
let d=snap.val();
ref.update({
points:d.points+p,
weeklyPoints:d.weeklyPoints+p
});
});
}

// ===== Weekly Rank =====
function updateWeekly(wp){
let rank="None";
if(wp>=20) rank="Platinum üèÜ";
else if(wp>=15) rank="Gold ü•á";
else if(wp>=10) rank="Silver ü•à";
else if(wp>=5) rank="Bronze ü•â";
weeklyRank.innerText=rank;
}

// ===== Logout =====
function logout(){
auth.signOut();
location.reload();
}
</script>

</body>
</html>
